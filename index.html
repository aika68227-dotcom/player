<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Player Multi-Resolusi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 700px; margin-top: 50px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-primary { background-color: #007bff; border: none; }
        .form-label { font-weight: 500; }
        .resolution-entry .form-control { border-radius: 0; }
        .resolution-entry .btn { border-radius: 0 0.375rem 0.375rem 0; }
        .resolution-entry:first-child .form-control:first-child { border-radius: 0.375rem 0 0 0.375rem; }
        .resolution-entry:first-child .form-control:last-child { border-radius: 0 0.375rem 0.375rem 0; }
    </style>
</head>
<body>

<div class="container">
    <h3 class="mb-4 text-center">Video Player Generator</h3>
    
    <!-- Bagian input resolusi yang telah disempurnakan -->
    <div class="mb-1">
        <label class="form-label">Resolusi Video</label>
        <div id="resolutions-container">
            <!-- Input pertama (default), tidak bisa dihapus -->
            <div class="resolution-entry input-group mb-2">
                <input type="text" class="form-control resolution-label" placeholder="Label (e.g., 720p)" required>
                <input type="url" class="form-control resolution-url w-50" placeholder="https://.../video-720p.mp4" required>
            </div>
        </div>
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addResolutionField()">+ Tambah Resolusi</button>
    </div>

    <div class="row mt-3">
        <div class="col-md-12 mb-3">
            <label class="form-label">Link Subtitle (.vtt)</label>
            <input type="url" id="subtitle" class="form-control" placeholder="https://domain.com/sub.vtt">
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Link Iklan VAST (Opsional)</label>
        <input type="url" id="ad_link" class="form-control" placeholder="https://ad-provider.com/vast.xml">
        <small class="text-muted">Iklan akan muncul sebagai Pre-Roll.</small>
    </div>

    <button type="button" onclick="generateLink()" class="btn btn-primary w-100 p-2">Generate Player Link</button>

    <div id="result" class="mt-4" style="display:none;">
        <hr>
        <label class="form-label">Link Player:</label>
        <div class="input-group mb-3">
            <input type="text" id="final_link" class="form-control" readonly>
            <button class="btn btn-outline-primary" onclick="copyToClipboard('final_link')">Copy</button>
        </div>

        <label class="form-label">Iframe Embed:</label>
        <div class="input-group">
            <textarea id="iframe_code" class="form-control" rows="3" readonly></textarea>
            <button class="btn btn-outline-primary" onclick="copyToClipboard('iframe_code')">Copy</button>
        </div>
    </div>
</div>

<script>
    /**
     * Menambahkan baris input baru untuk resolusi video.
     */
    function addResolutionField() {
        const container = document.getElementById('resolutions-container');
        const newEntry = document.createElement('div');
        newEntry.className = 'resolution-entry input-group mb-2';
        newEntry.innerHTML = `
            <input type="text" class="form-control resolution-label" placeholder="Label (e.g., 480p)">
            <input type="url" class="form-control resolution-url w-50" placeholder="https://.../video-480p.mp4">
            <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">Hapus</button>
        `;
        container.appendChild(newEntry);
    }

    /**
     * Mengumpulkan semua data, termasuk multi-resolusi, dan membuat link.
     */
    function generateLink() {
        const resolutionEntries = document.querySelectorAll('.resolution-entry');
        const sources = [];

        resolutionEntries.forEach(entry => {
            const label = entry.querySelector('.resolution-label').value.trim();
            const url = entry.querySelector('.resolution-url').value.trim();
            // Hanya tambahkan jika kedua field diisi
            if (label && url) {
                sources.push({
                    file: url,  // 'file' adalah properti yang umum digunakan oleh player
                    label: label
                });
            }
        });

        if (sources.length === 0) {
            alert("Harap masukkan setidaknya satu link video dan label resolusi!");
            return;
        }

        const sub = document.getElementById('subtitle').value;
        const ad = document.getElementById('ad_link').value;

        // Struktur data baru untuk mendukung multi-resolusi
        const data = {
            sources: sources,
            s: sub,
            a: ad
        };
        
        // Encode ke Base64 (proses ini tetap sama)
        const encodedData = btoa(JSON.stringify(data));
        
        const currentPath = window.location.pathname.replace(/index\.html$/, '');
        const playerUrl = window.location.origin + currentPath + 'player.html?id=' + encodedData;
        
        const iframe = `<iframe src="${playerUrl}" width="640" height="360" frameborder="0" allowfullscreen allow="autoplay"></iframe>`;

        document.getElementById('final_link').value = playerUrl;
        document.getElementById('iframe_code').value = iframe;
        document.getElementById('result').style.display = 'block';
    }

    /**
     * Menyalin teks ke clipboard.
     */
    function copyToClipboard(id) {
        const copyText = document.getElementById(id);
        copyText.select();
        copyText.setSelectionRange(0, 99999); // Untuk mobile
        try {
            navigator.clipboard.writeText(copyText.value);
            alert("Berhasil disalin!");
        } catch (err) {
            // Fallback untuk browser lama
            document.execCommand("copy");
            alert("Berhasil disalin!");
        }
    }
</script>
</body>
</html>
